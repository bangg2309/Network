package exam12;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class StudentManagement {

	public void writeTofile(String pathFile, List<Student> students) throws IOException {

		DataOutputStream dos = new DataOutputStream(new FileOutputStream(pathFile));
		int size = students.size();
		dos.writeInt(size);
		for (Student student : students) {
			dos.writeInt(student.getId());
			dos.writeUTF(student.getName());
			int sizeSubject = student.getSubjects().size();
			dos.writeInt(size);
			for (Subject subject : student.getSubjects()) {
				dos.writeUTF(subject.getName());
				dos.writeDouble(subject.getScore());
			}
		}
		dos.close();
	}

	public List<Student> readToFile(String pathFile) throws IOException {
		DataInputStream dis = new DataInputStream(new FileInputStream(pathFile));
		List<Student> students = new ArrayList<>();
		int size = dis.readInt();
		for (int i = 0; i < size; i++) {
			int id = dis.readInt();
			String name = dis.readUTF();
			int sizeSubject = dis.readInt();
			List<Subject> subjects = new ArrayList<>();
			for (int j = 0; j < sizeSubject; j++) {
				String subjectName = dis.readUTF();
				double score = dis.readDouble();
				Subject subject = new Subject(subjectName, score);
				subjects.add(subject);
			}
			Student student = new Student(name, id, subjects);
			students.add(student);
		}
		dis.close();
		return students;
	}

	public void getAvarageStudents(String pathFile) throws IOException {
		List<Student> students = readToFile(pathFile);
		for (Student student : students) {
			System.out.println("ID: " +student.getId() +"\t" + "Ho va ten: " + student.getName() + "\t" + "DTB: " + student.getAverage());
		}
	}

}
